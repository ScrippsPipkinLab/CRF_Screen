bbplot
bbplot <- ggplot(in.df, aes(x=in.df$log2FC, y=in.df$Ranks, size=dot.size)) +
geom_point(alpha=0.7, color = dot.col, shape=20) +
geom_vline(xintercept=0, colour="black") +
geom_vline(xintercept=2, colour="grey", size=0.1) +
geom_vline(xintercept=-2, colour="grey", size=0.1) +
xlab(x.name) + labs(title = fig.title, subtitle = "Highlighted Tfh(red) / Th1(blue) associated genes", size=paste(g1, " TPM", sep="")) +
scale_x_continuous(limits = c(-8, 8)) +
theme(axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.title.y=element_blank(),
panel.background = element_rect(fill = "white", linetype = "solid"),
panel.grid.major = element_line(size = 0.1, linetype = 'solid', colour = "grey"),
plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))
bbplot <- bbplot +
geom_text_repel(aes(label=in.df$dotname), alpha=0.8 )
#--- Save
ggsave(out.name, bbplot, device="png", width = 7, height = 7, dpi=320)
print(.libPaths())
library(ChIPQC)
print(.libPaths())
which R
read.csv("1.csv")
source('/Volumes/Yolanda/CRF_Screen/0_Codes/3_tsne_cbs-plot_byGene_groups.R')
##########---------- Main
in_file <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/compiled_Amt/per5/Amt_normbycontrolZP_t-test.by.geneavg_z-score_tsne_per5.csv"
in_df <- read.csv(in.file)
##########---------- Main
in_file <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/compiled_Amt/per5/Amt_normbycontrolZP_t-test.by.geneavg_z-score_tsne_per5.csv"
in_df <- read.csv(in_file)
###----- Group1
slt_df1 <- subset(in_df, in_df$t2>50)
g1_list <- unlist(slt_df1$gene_name)
#cbs_plot(in_file, g1_list, "g1")
###----- Group2
slt_df2 <- subset(in_df, (in_df$t1>50)&(in_df$t2<0))
g2_list <- unlist(slt_df2$gene_name)
#cbs_plot(in_file, g2_list, "g2")
###----- Group3
slt_df3 <- subset(in_df, in_df$t1 < -70)
g3_list <- unlist(slt_df3$gene_name)
#cbs_plot(in_file, g3_list, "g3")
###----- Group4
slt_df4 <- subset(in_df, (in_df$t1 < -25)&(in_df$t1 > -70) | ( ((in_df$t1 < 0)&(in_df$t1 > -50)) & ((in_df$t2>0)&(in_df$t2<50)) ) )
g4_list <- unlist(slt_df4$gene_name)
#cbs_plot(in_file, g4_list, "g4")
###----- Group5
slt_df5 <- subset(in_df, in_df$t2 < -30)
g5_list <- unlist(slt_df5$gene_name)
#cbs_plot(in_file, g5_list, "g5")
###----- Group6
slt_df6 <- subset(in_df, (in_df$t1 > -25)&(in_df$t1 <20)&(in_df$t2<0)&(in_df$t2> -30))
g6_list <- unlist(slt_df6$gene_name)
#cbs_plot(in_file, g6_list, "g6")
###----- Group7
slt_df7 <- subset(in_df, (in_df$t1 > 50)&(in_df$t2> 0))
g7_list <- unlist(slt_df7$gene_name)
#cbs_plot(in_file, g7_list, "g7")
###----- Group8
slt_df8 <- subset(in_df, (in_df$t1 > 30)&(in_df$t1< 50)&(in_df$t2<25))
g8_list <- unlist(slt_df8$gene_name)
#cbs_plot(in_file, g8_list, "g8")
###----- Group9
slt_df9 <- subset(in_df, (in_df$t1 < 30)&(in_df$t1 > 15)&(in_df$t2<25))
g9_list <- unlist(slt_df9$gene_name)
#cbs_plot(in_file, g9_list, "g9")
###----- Group10
slt_df10 <- subset(in_df, (in_df$t1 < 50)&(in_df$t1 > 0)&(in_df$t2<50)&(in_df$t2>25))
g10_list <- unlist(slt_df10$gene_name)
#cbs_plot(in_file, g10_list, "g10")
group_lists <- list(g1_list, g2_list, g3_list, g4_list, g5_list,
g6_list, g7_list, g8_list, g9_list, g10_list)
genes.i <- all_df$gene_name
group_lists <- list(g1_list, g2_list, g3_list, g4_list, g5_list,
g6_list, g7_list, g8_list, g9_list, g10_list)
genes.i <- group_lists[1]
genes.i
genes.i <- as.character(unlist(group_lists[1]))
genes.i
egoBP <- enrichGO(gene = genes.i, keyType = 'SYMBOL', OrgDb = org.Mm.eg.db, ont = "BP", pAdjustMethod = "BH", qvalueCutoff = 0.05, readable = TRUE)
select(org.Mm.eg.db, genes.i, c("ENTREZID","GENENAME"), "ALIAS")
select(org.Mm.eg.db, genes.i, c("ENTREZID"), "ALIAS")
genes.i.id <- select(org.Mm.eg.db, genes.i, c("ENTREZID"), "ALIAS")
genes.i.id
genes.i.id$ENTREZID
egoBP <- enrichGO(gene = genes.i.id$ENTREZID, keyType = 'ENTREZID', OrgDb = org.Mm.eg.db, ont = "BP", pAdjustMethod = "BH", qvalueCutoff = 0.05, readable = TRUE)
egoBP
for (i in c(1:length(group_lists))) {
setwd("/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/compiled_Amt")
genes.i <- as.character(unlist(group_lists[i]))
genes.i.id <- select(org.Mm.eg.db, genes.i, c("ENTREZID"), "ALIAS")
genes.i.id$ENTREZID
egoBP <- enrichGO(gene = genes.i.id$ENTREZID, keyType = 'ENTREZID', OrgDb = org.Mm.eg.db, ont = "BP", pAdjustMethod = "BH", qvalueCutoff = 0.05, readable = TRUE)
egoCC <- enrichGO(gene = genes.i.id$ENTREZID, keyType = 'ENTREZID', OrgDb = org.Mm.eg.db, ont = "CC", pAdjustMethod = "BH", qvalueCutoff = 0.05, readable = TRUE)
egoMF <- enrichGO(gene = genes.i.id$ENTREZID, keyType = 'ENTREZID', OrgDb = org.Mm.eg.db, ont = "MF", pAdjustMethod = "BH", qvalueCutoff = 0.05, readable = TRUE)
# Dotplot visualization
if (!is.null(egoBP)){
egoBP.dotplot <- dotplot(egoBP, showCategory=25)
ggsave(paste(i,"_BP_dotplot.pdf",sep=""), egoBP.dotplot, device = "pdf", width = 30, height = 20, units = "cm")
}
if(!is.null(egoCC)){
egoCC.dotplot <- dotplot(egoCC, showCategory=25)
ggsave(paste(i,"_CC_dotplot.pdf",sep=""), egoCC.dotplot, device = "pdf", width = 30, height = 20, units = "cm")
}
if(!is.null(egoMF)){
egoMF.dotplot <- dotplot(egoMF, showCategory=25)
ggsave(paste(i,"_MF_dotplot.pdf",sep=""), egoMF.dotplot, device = "pdf", width = 30, height = 20, units = "cm")
}
}
source('/Volumes/Yolanda/CRF_Screen/0_Codes/3_tsne_cbs-plot_byGene.R')
source('/Volumes/Yolanda/CRF_Screen/0_Codes/3_tsne_cbs-plot_byGene.R')
install.packages('Seurat')
library(Seurat)
library(dplyr)
########## Seurat for ScRNAseq ##########
# Author: Huitian (Yolanda) Diao
# Apr 314th, 2019
# CD25KO ScRNAseq analysis
########## Libraries ##########
library(dplyr)
library(Seurat)
sc.data <- Read10X(data.dir = "/Volumes/HD_EXP334/Exp334CD25KOSc/n10000_outs/filtered_feature_bc_matrix")
sc.data <- Read10X(data.dir = "/Volumes/HD_EXP334/Exp334CD25KOSc/n10000_outs/filtered_feature_bc_matrix")
# Save features.tsv to genes.tsv
sc.data <- Read10X(data.dir = "/Volumes/HD_EXP334/Exp334CD25KOSc/n10000_outs/filtered_feature_bc_matrix")
# Initialize the Seurat object with the raw (non-normalized data)
sc <- CreateSeuratObject(counts = sc.data, project = "Exp334CD25KO", min.cells = 3, min.features = 200)
sc <- CreateSeuratObject(counts = sc.data, project = "Exp334CD25KO", min.cells = 3, min.features = 200)
sc <- CreateSeuratObject(sc.data, project = "Exp334CD25KO", min.cells = 3, min.features = 200)
# The [[ operator can add columns to object metadata. This is a great place to stash QC stats
pbmc[["percent.mt"]] <- PercentageFeatureSet(object = pbmc, pattern = "^MT-")
# The [[ operator can add columns to object metadata. This is a great place to stash QC stats
pbmc[["percent.mt"]] <- PercentageFeatureSet(object = sc, pattern = "^MT-")
# Visualize QC metrics as a violin plot
VlnPlot(object = pbmc, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
# Visualize QC metrics as a violin plot
VlnPlot(object = pbmc, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"))
VlnPlot(object = sc, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"))
str(sc)
VlnPlot(object = sc, features = c( "nCount_RNA", "percent.mt"))
sc <- NormalizeData(sc, normalization.method = "LogNormalize", scale.factor = 10000)
head(sc.data)
tail(sc.data)
str(sc.data)
sc.data[c("CD25KO_TotalA","CD25WT_TotalA","EndoNAV_TotalA","P14NAV_TotalA"), 1:30]
head(sc.data)
str(sc.data)
sc.data$i
sc.data@i
sc.data@Dim
sc.data@Dimnames
str(sc.data)
str(sc.data@Dimnames)
sc.data@Dimnames[0]
install.packages("magrittr")
install.packages("magrittr")
install.packages("magrittr")
install.packages("magrittr")
library(magrittr)
BiocManager::install("MEDIPS", version = "3.8")
install.packages("igraph")
install.packages("igraph")
install.packages("igraph")
install.packages("igraph")
install.packages("igraph")
library(ggplot2)
library(dplyr)
libray(magrittr)
library(magrittr)
library(ggrepel)
tsne.real = read.csv("https://docs.google.com/uc?id=1KArwfOd5smzuCsrpgW9Xpf9I06VOW4ga&export=download")
info.real = tsne.real
ggplot(tsne.real, aes(x = tsne1, y = tsne2)) + geom_point(alpha = 0.1) +
theme_bw()
k = 100
knn.real = get.knn(as.matrix(tsne.real), k = k)
knn.real = data.frame(from = rep(1:nrow(knn.real$nn.index),
k), to = as.vector(knn.real$nn.index), weight = 1/(1 + as.vector(knn.real$nn.dist)))
nw.real = graph_from_data_frame(knn.real, directed = FALSE)
nw.real = simplify(nw.real)
lc.real = cluster_louvain(nw.real, gamma = 0.1)
info.real$louvain = as.factor(membership(lc.real))
lc.cent = info.real %>% group_by(louvain) %>% select(tsne1,
tsne2) %>% summarize_all(mean)
ggplot(info.real, aes(x = tsne1, y = tsne2, colour = louvain)) +
geom_point(alpha = 0.3) + theme_bw() + geom_label_repel(aes(label = louvain),
data = lc.cent) + guides(colour = FALSE)
k = 100
knn.real = get.knn(as.matrix(tsne.real), k = k)
library(igraph)
library(FNN)
install.packages("FNN")
library(FNN)
k = 100
knn.real = get.knn(as.matrix(tsne.real), k = k)
knn.real = data.frame(from = rep(1:nrow(knn.real$nn.index),
k), to = as.vector(knn.real$nn.index), weight = 1/(1 + as.vector(knn.real$nn.dist)))
nw.real = graph_from_data_frame(knn.real, directed = FALSE)
nw.real = simplify(nw.real)
lc.real = cluster_louvain(nw.real, gamma = 0.1)
info.real$louvain = as.factor(membership(lc.real))
lc.cent = info.real %>% group_by(louvain) %>% select(tsne1,
tsne2) %>% summarize_all(mean)
ggplot(info.real, aes(x = tsne1, y = tsne2, colour = louvain)) +
geom_point(alpha = 0.3) + theme_bw() + geom_label_repel(aes(label = louvain),
data = lc.cent) + guides(colour = FALSE)
library(igraph)
lc.real = cluster_louvain(nw.real, gamma = 0.1)
lc.cent = info.real %>% group_by(louvain) %>% select(tsne1,
tsne2) %>% summarize_all(mean)
info.real$louvain = as.factor(membership(lc.real))
lc.real = cluster_louvain(nw.real, gamma = 0.1)
lc.real = cluster_louvain(nw.real) #, gamma = 0.1
info.real$louvain = as.factor(membership(lc.real))
lc.cent = info.real %>% group_by(louvain) %>% select(tsne1,
tsne2) %>% summarize_all(mean)
lc.real = cluster_louvain(nw.real) #, gamma = 0.1
info.real$louvain = as.factor(membership(lc.real))
lc.cent = info.real %>% group_by(louvain) %>% select(tsne1,
tsne2) %>% summarize_all(mean)
ggplot(info.real, aes(x = tsne1, y = tsne2, colour = louvain)) +
geom_point(alpha = 0.3) + theme_bw() + geom_label_repel(aes(label = louvain),
data = lc.cent) + guides(colour = FALSE)
browseVignettes("DESeq2")
packageVersion("DESeq2")
DESmat<-DESeqDataSetFromMatrix(countData = DeseqData, colData = DeseqDesign,design = ~ condition)
#---- Read input file
DeseqData <- read.csv(count.file,header=TRUE, row.names=1)
#---- Meta data
DeseqDesign <- data.frame(row.names=rownames,condition=as.factor(conds))
#---- Generate DEseq matrix
DESmat <- DESeqDataSetFromMatrix(countData = DeseqData, colData = DeseqDesign,design = ~ condition)
install.packages("gridExtra")
install.packages("gridExtra")
install.packages("gridExtra")
install.packages("yaml")
########## Imports ##########
library(DEseq2)
library(DEseq2)
BiocManager::install("DESeq2")
install.packages("RcppArmadillo")
library(DEseq2)
library(DEseq2)
install.packages("Rcpp","RcppArmadillo","inline","rbenchmark")
install.packages("Rcpp", "RcppArmadillo", "inline", "rbenchmark")
install.packages("Rcpp", "RcppArmadillo", "inline", "rbenchmark")
install.packages("Rcpp")
install.packages("Rcpp")
install.packages("Rcpp")
########## Imports ##########
library(igraph)
library(FNN)
library(ggplot2)
library(ggrepel)
library(dplyr)
library(magrittr)
library("clusterProfiler")
#BiocManager::install("org.Mm.eg.db")
library("org.Mm.eg.db")
########## Converted Data analysis ##########
# Author: Huitian (Yolanda) Diao
# Dec 3rd, 2018
# For t-test with percentiles
########## Libraries ##########
library(BSDA)
########## Self-defined functions ##########
simpName <- function(vec.x) {
new.vec <- character(length(vec.x))
for (x in 1:length(vec.x)){
new.x <- gsub("_shRNA_normbycontrolZP_t-test.by.gene.csv", "", vec.x[x])
new.x <- gsub("Amt_", "", new.x)
new.x <- gsub("AmtGFP_", "", new.x)
new.vec[x] <- new.x
}
return(new.vec)
}
simpNameOne <- function(str.x) {
new.x <- gsub("_shRNA_normbycontrolZP_t-test.by.gene.csv", "", str.x)
new.x <- gsub("Amt_", "", new.x)
new.x <- gsub("AmtGFP_", "", new.x)
return(new.x)
}
shRNAtoGene <- function(vec.x){
#vec.x <- c("Smarce1.1", "Smarce1.2",  "Smarce1.3",  "Smarce1.4", "Msl3.1")
new.vec <- numeric(length(vec.x))
for (x in 1:length(vec.x)){
new.vec[x] <- unlist(strsplit(vec.x[x], "\\."))[1]
}
return(new.vec)
}
tByGene <- function(file.x){
#file.x <- "/Users/yolandatiao/Desktop/CRF_Screen/1_2_normtocontrol_ZP/AmtGFP/AmtGFP_CD25GeoMean_10U_shRNA_normbycontrolZP.csv"
out.name <- gsub(".csv", "_t-test.by.gene.csv",file.x)
x.df <- read.csv(file.x)
x.df <- subset(x.df,
!(grepl("11", x.df$Position) & grepl("control", x.df$Position))
| !grepl("Cd4", x.df$shRNA) ) # Exclude weird shCd4 sample
shRNA.vec <- as.character(unlist(x.df$shRNA))
gene.vec <- unique(shRNAtoGene(shRNA.vec))
gene.vec <- sort(gene.vec)
all.p.vec <- as.numeric(unlist(x.df$precentile))
out.df <- data.frame(matrix(ncol = 4, nrow = 0))
colnames(out.df) <- c("gene_name", "avg_percentile", "avg_z-score", "t-test_p-value")
for (gene in gene.vec){
gene.df <- subset(x.df, grepl(gene, x.df$shRNA))
if ( nrow(gene.df) > 1) {
gene.p.vec <- as.numeric(unlist(gene.df$precentile))
gene.z.vec <- as.numeric(unlist(gene.df$z))
gene.t.test <- t.test(x = gene.p.vec, y = all.p.vec)
new.row <- c(gene, mean(gene.p.vec), mean(gene.z.vec), gene.t.test$p.value)
out.df[nrow(out.df) + 1,] = new.row
}
}
write.csv(out.df, out.name, row.names = FALSE)
}
compileData <- function(in.dir, out.base.name){
setwd(in.dir)
files <- list.files(path=in.dir, pattern="Amt_*", full.name=FALSE, recursive=FALSE)
newheader <- simpName(files)
newheader <- c("gene_name", newheader)
df.1 <- read.csv(files[1])
out.df.p <- data.frame(matrix(ncol = 0, nrow = nrow(df.1)))
out.df.z <- data.frame(matrix(ncol = 0, nrow = nrow(df.1)))
out.df.t <- data.frame(matrix(ncol = 0, nrow = nrow(df.1)))
out.df.p$gene_name <- as.character(unlist(df.1$gene_name))
out.df.z$gene_name <- as.character(unlist(df.1$gene_name))
out.df.t$gene_name <- as.character(unlist(df.1$gene_name))
for (file in files){
print(file)
df.x <- read.csv(file)
df.p <- data.frame("gene_name" = df.x$gene_name)
df.z <- data.frame("gene_name" = df.x$gene_name)
df.t <- data.frame("gene_name" = df.x$gene_name)
df.p$pval <- as.numeric(unlist(df.x$avg_percentile))
df.z <- cbind(df.z, as.numeric(unlist(df.x$avg_z.score)))
df.t$t <- as.numeric(unlist(df.x$t.test_p.value))
colnames(df.p) <- c("gene_name", simpNameOne(file))
colnames(df.z) <- c("gene_name", simpNameOne(file))
colnames(df.t) <- c("gene_name", simpNameOne(file))
out.df.p <- merge(out.df.p, df.p, by="gene_name")
out.df.z <- merge(out.df.z, df.z, by="gene_name")
out.df.t <- merge(out.df.t, df.t, by="gene_name")
}
colnames(out.df.p) <- newheader
colnames(out.df.z) <- newheader
colnames(out.df.t) <- newheader
out.name.p <- paste(out.base.name, "_avg_percentile.csv", sep="")
out.name.z <- paste(out.base.name, "avg_z-score.csv", sep="")
out.name.t <- paste(out.base.name, "t-test_p-value.csv", sep="")
write.csv(out.df.p, out.name.p, row.names = FALSE)
write.csv(out.df.z, out.name.z, row.names = FALSE)
write.csv(out.df.t, out.name.t, row.names = FALSE)
}
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/1_2_normtocontrol_ZP/Amt"
setwd(wk.dir)
files <- list.files(path=wk.dir, pattern="*ZP.csv", full.name=FALSE, recursive=FALSE)
for (file in files) {
tByGene(file)
}
source('/Volumes/Yolanda/CRF_Screen/0_Codes/2_convertedDataAnalysis.R')
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/1_2_normtocontrol_ZP/Amt"
setwd(wk.dir)
files <- list.files(path=wk.dir, pattern="*ZP.csv", full.name=FALSE, recursive=FALSE)
for (file in files) {
tByGene(file)
}
wk.dir <-"/Volumes/Yolanda/CRF_Screen/InVitro/1_2_normtocontrol_ZP/AmtGFP"
setwd(wk.dir)
files <- list.files(path=wk.dir, pattern="*ZP.csv", full.name=FALSE, recursive=FALSE)
for (file in files) {
tByGene(file)
}
wk.dir <-"/Volumes/Yolanda/CRF_Screen/InVitro/1_2_normtocontrol_ZP/AmtGFP"
setwd(wk.dir)
files <- list.files(path=wk.dir, pattern="*ZP.csv", full.name=FALSE, recursive=FALSE)
for (file in files) {
tByGene(file)
}
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/Sep_Amt"
out.base.name <- "Amt_normbycontrolZP_t-test.by.gene"
compileData(wk.dir, out.base.name)
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/Sep_AmtGFP"
out.base.name <- "AmtGFP_normbycontrolZP_t-test.by.gene"
compileData(wk.dir, out.base.name)
source('/Volumes/Yolanda/CRF_Screen/0_Codes/3_tsne_cbs-plot_byGene.R')
source('/Volumes/Yolanda/CRF_Screen/0_Codes/3_tsne_cbs-plot_byGene.R')
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/tsne_bbplot"
setwd(wk.dir)
tsne <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.geneavg_z-score_tsne_per6.csv"
z.score <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.geneavg_z-score.csv"
p.value <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.genet-test_p-value.csv"
colnames.vec <- c("CD103Percentage_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD103Percentage_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD127GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD127GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD25GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD25GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD44GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD44GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD62LPercentage_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD62LPercentage_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CXCR3GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CXCR3GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CXCR3Percentage_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CXCR3Percentage_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Lag3GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Lag3GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "PD1GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "PD1GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Tim3GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Tim3GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Tim3Percentage_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Tim3Percentage_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv")
for (i in colnames.vec) {
build_df(tsne, z.score, p.value, i)
}
}
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/tsne_bbplot"
setwd(wk.dir)
tsne <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.geneavg_z-score_tsne_per6.csv"
z.score <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.geneavg_z-score.csv"
p.value <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.genet-test_p-value.csv"
colnames.vec <- c("CD103Percentage_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD103Percentage_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD127GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD127GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD25GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD25GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD44GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD44GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD62LPercentage_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CD62LPercentage_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CXCR3GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CXCR3GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CXCR3Percentage_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "CXCR3Percentage_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Lag3GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Lag3GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "PD1GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "PD1GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Tim3GeoMean_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Tim3GeoMean_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Tim3Percentage_100U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv", "Tim3Percentage_10U_shRNA_fixed_normbycontrolZP_t-test.by.gene.csv")
for (i in colnames.vec) {
build_df(tsne, z.score, p.value, i)
}
source('/Volumes/Yolanda/CRF_Screen/0_Codes/3_tsne_cbs-plot_byGene.R')
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/tsne_bbplot"
setwd(wk.dir)
tsne <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.geneavg_z-score_tsne_per6.csv"
z.score <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.geneavg_z-score.csv"
p.value <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/Amt_normbycontrolZP_t-test.by.genet-test_p-value.csv"
colnames.vec <- c("CD103Percentage_100U", "CD103Percentage_10U", "CD127GeoMean_100U", "CD127GeoMean_10U", "CD25GeoMean_100U", "CD25GeoMean_10U", "CD44GeoMean_100U", "CD44GeoMean_10U", "CD62LPercentage_100U", "CD62LPercentage_10U", "CXCR3GeoMean_100U", "CXCR3GeoMean_10U", "CXCR3Percentage_100U", "CXCR3Percentage_10U", "Lag3GeoMean_100U", "Lag3GeoMean_10U", "PD1GeoMean_100U", "PD1GeoMean_10U", "Tim3GeoMean_100U", "Tim3GeoMean_10U", "Tim3Percentage_100U", "Tim3Percentage_10U")
for (i in colnames.vec) {
build_df(tsne, z.score, p.value, i)
}
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/tsne_bbplot"
setwd(wk.dir)
files <- list.files(path = wk.dir, pattern = "tsnf-z-p.csv", full.name=FALSE, recursive=FALSE)
for (file.x in files){
cbs_plot(file.x)
}
cbs_plot <- function(in.file){
in.df <- read.csv(in.file)
in.df$nlog10p <- -log10(in.df$pValue + 0.00001)
in.df <- slt_anno(in.df)
# Save plot spreadsheet
out.csv.name <- gsub(".csv", "_cbs.csv", in.file)
write.csv(in.df, out.csv.name, row.names = FALSE)
cbs.plot <- ggplot(in.df, aes(x=in.df$t1, y=in.df$t2, color=in.df$zScore, size=in.df$nlog10p)) +
geom_point(alpha = 0.8, shape = 19) +
scale_color_gradient2(midpoint=0, limits = c(-4,4), low="dodgerblue4", mid="white", high="firebrick4", space ="Lab" ) +
scale_x_continuous(limits = c(-100, 100)) +
scale_y_continuous(limits = c(-100, 100)) +
theme(panel.background = element_rect(fill = "white", colour = "white",size = 0.5, linetype = "solid"),
panel.grid.major = element_line(size = 0.25, linetype = 'solid', colour = "grey"),
panel.grid.minor = element_line(size = 0.15, linetype = 'solid',colour = "grey"),
text = element_text(size=10))
# Save without annotation
out.name <- gsub(".csv", ".pdf", in.file)
ggsave(out.name, plot = cbs.plot, device = "pdf", units = "cm", width = 25, height = 25)
# Save with annotation
cbs.plot <- cbs.plot +
geom_text_repel(aes(label = in.df$gene_name_anno), size = 6)
out.name <- gsub(".csv", "_anno.pdf", in.file)
ggsave(out.name, plot = cbs.plot, device = "pdf", units = "cm", width = 25, height = 25)
}
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/tsne_bbplot"
setwd(wk.dir)
files <- list.files(path = wk.dir, pattern = "tsnf-z-p.csv", full.name=FALSE, recursive=FALSE)
for (file.x in files){
cbs_plot(file.x)
}
cbs_plot <- function(in.file){
in.df <- read.csv(in.file)
in.df$nlog10p <- -log10(in.df$pValue + 0.00001)
in.df <- slt_anno(in.df)
# Save plot spreadsheet
out.csv.name <- gsub(".csv", "_cbs.csv", in.file)
write.csv(in.df, out.csv.name, row.names = FALSE)
cbs.plot <- ggplot(in.df, aes(x=in.df$t1, y=in.df$t2, color=in.df$zScore, size=in.df$nlog10p)) +
geom_point(alpha = 0.8, shape = 19) +
scale_color_gradient2(midpoint=0, limits = c(-5,5), low="dodgerblue4", mid="white", high="firebrick4", space ="Lab" ) +
scale_x_continuous(limits = c(-100, 100)) +
scale_y_continuous(limits = c(-100, 100)) +
theme(panel.background = element_rect(fill = "white", colour = "white",size = 0.5, linetype = "solid"),
panel.grid.major = element_line(size = 0.25, linetype = 'solid', colour = "grey"),
panel.grid.minor = element_line(size = 0.15, linetype = 'solid',colour = "grey"),
text = element_text(size=10))
# Save without annotation
out.name <- gsub(".csv", ".pdf", in.file)
ggsave(out.name, plot = cbs.plot, device = "pdf", units = "cm", width = 25, height = 25)
# Save with annotation
cbs.plot <- cbs.plot +
geom_text_repel(aes(label = in.df$gene_name_anno), size = 6)
out.name <- gsub(".csv", "_anno.pdf", in.file)
ggsave(out.name, plot = cbs.plot, device = "pdf", units = "cm", width = 25, height = 25)
}
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/tsne_bbplot"
setwd(wk.dir)
files <- list.files(path = wk.dir, pattern = "tsnf-z-p.csv", full.name=FALSE, recursive=FALSE)
for (file.x in files){
cbs_plot(file.x)
}
cbs_plot <- function(in.file){
in.df <- read.csv(in.file)
in.df$nlog10p <- -log10(in.df$pValue + 0.00001)
in.df <- slt_anno(in.df)
# Save plot spreadsheet
out.csv.name <- gsub(".csv", "_cbs.csv", in.file)
write.csv(in.df, out.csv.name, row.names = FALSE)
cbs.plot <- ggplot(in.df, aes(x=in.df$t1, y=in.df$t2, color=in.df$zScore, size=in.df$nlog10p)) +
geom_point(alpha = 0.8, shape = 19) +
scale_color_gradient2(midpoint=0, limits = c(-6,6), low="dodgerblue4", mid="white", high="firebrick4", space ="Lab" ) +
scale_x_continuous(limits = c(-100, 100)) +
scale_y_continuous(limits = c(-100, 100)) +
theme(panel.background = element_rect(fill = "white", colour = "white",size = 0.5, linetype = "solid"),
panel.grid.major = element_line(size = 0.25, linetype = 'solid', colour = "grey"),
panel.grid.minor = element_line(size = 0.15, linetype = 'solid',colour = "grey"),
text = element_text(size=10))
# Save without annotation
out.name <- gsub(".csv", ".pdf", in.file)
ggsave(out.name, plot = cbs.plot, device = "pdf", units = "cm", width = 25, height = 25)
# Save with annotation
cbs.plot <- cbs.plot +
geom_text_repel(aes(label = in.df$gene_name_anno), size = 6)
out.name <- gsub(".csv", "_anno.pdf", in.file)
ggsave(out.name, plot = cbs.plot, device = "pdf", units = "cm", width = 25, height = 25)
}
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVitro/2_0_t-test_by_gene/1_Compile_Amt/tsne_plot_source_files"
setwd(wk.dir)
files <- list.files(path = wk.dir, pattern = "tsnf-z-p.csv", full.name=FALSE, recursive=FALSE)
for (file.x in files){
cbs_plot(file.x)
}
