anno.vec <- c("Chd7", "Tbx21", "Brd4", "Id2", "Bcl6","Smarca4",
"Mll1", "Runx3")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q3minusOther, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right") +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
out.name <- "Q3minusOther.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q3minusOther)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21", "Brd4", "Id2", "Bcl6","Smarca4",
"Mll1", "Runx3")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q3minusOther, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right") +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
out.name <- "Q3minusOther.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q3minusOther)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21","Id2", "Bcl6","Smarca4",
"Mll1")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q3minusOther, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right") +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
out.name <- "InputMinusAvg.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(z.p.tb$InputMinusAvg)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21","Id2", "Bcl6","Smarca4",
"Mll1")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$InputMinusAvg, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right") +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
anno.vec <- c("Chd7", "Tbx21","Id2", "Bcl6","Smarca4",
"Mll1")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q3minusOther, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right") +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
#####---------- Input v.s. output
out.name <- "InputMinusAvg.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(z.p.tb$InputMinusAvg)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Ing3", "Bop1", "Bcl6", "Rpa3", "Mll1")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$InputMinusAvg, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right") +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVivo/1_1_Norm/6_zscore_div_sqrt-pval"
setwd(wk.dir)
z.p.file <- "all_z-score_div_sqrt-p.csv"
z.p.tb <- read_csv(z.p.file)
z.p.tb <- z.p.tb %>%
mutate(Q4minusQ1 = abs(Q4minusQ1_z_p) / Q4minusQ1_z_p * sqrt(abs(Q4minusQ1_z_p))) %>%
mutate(Q3minusOther = abs(Q3minusOther_z_p) / Q3minusOther_z_p * sqrt(abs(Q3minusOther_z_p))) %>%
mutate(InputMinusAvg = abs(InputMinusAvg_z_p) / InputMinusAvg_z_p * sqrt(abs(InputMinusAvg_z_p))) %>%
select(gene_name, Q4minusQ1, Q3minusOther, InputMinusAvg)
write_csv(z.p.tb, "all_z-score_div_sqrt-p_sqrt.csv")
z.p.tb <- z.p.tb %>% column_to_rownames("gene_name")
col.pal <- colorRampPalette(brewer.pal(n=11, name="RdBu"))
col.use <- rev(col.pal(50))
z.p.heatmap <- pheatmap(z.p.tb , color=col.use, cluster_cols = FALSE, show_rownames = FALSE)
save_pheatmap_pdf(z.p.heatmap, "zscore_div_sqrt-pval.pdf", 5, 45)
}
##########-------------------- Bar plot
if (FALSE) {
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVivo/1_1_Norm/6_zscore_div_sqrt-pval"
setwd(wk.dir)
z.p.file <- "all_z-score_div_sqrt-p_sqrt.csv"
z.p.tb <- read_csv(z.p.file)
#z.p.tb <- z.p.tb %>% column_to_rownames("gene_name")
#####---------- Q4 minus Q1
out.name <- "Q4minusQ1.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q4minusQ1)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21", "Brd4", "Id2", "Bcl6","Smarca4",
"Mll1", "Runx3")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q4minusQ1, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
#####---------- Q3 minus other
out.name <- "Q3minusOther.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q3minusOther)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21","Id2", "Bcl6","Smarca4",
"Mll1")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q3minusOther, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
#####---------- Input v.s. output
out.name <- "InputMinusAvg.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(z.p.tb$InputMinusAvg)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Ing3", "Bop1", "Bcl6", "Rpa3", "Mll1")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$InputMinusAvg, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
out.name <- "Q4minusQ1.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q4minusQ1)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21", "Brd4", "Id2", "Bcl6","Smarca4",
"Mll1", "Runx3")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q4minusQ1, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
)
out.name <- "Q4minusQ1.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q4minusQ1)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21", "Brd4", "Id2", "Bcl6","Smarca4",
"Mll1", "Runx3")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q4minusQ1, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
# Plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q4minusQ1, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q4minusQ1, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right") +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
out.name <- "Q4minusQ1.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q4minusQ1)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21", "Brd4", "Id2", "Bcl6","Smarca4",
"Mll1", "Runx3")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
wk.dir <- "/Volumes/Yolanda/CRF_Screen/InVivo/1_1_Norm/6_zscore_div_sqrt-pval"
setwd(wk.dir)
z.p.file <- "all_z-score_div_sqrt-p_sqrt.csv"
z.p.tb <- read_csv(z.p.file)
#z.p.tb <- z.p.tb %>% column_to_rownames("gene_name")
#####---------- Q4 minus Q1
out.name <- "Q4minusQ1.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q4minusQ1)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21", "Brd4", "Id2", "Bcl6","Smarca4",
"Mll1", "Runx3")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q4minusQ1, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
out.name <- "Q3minusOther.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(Q3minusOther)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Chd7", "Tbx21","Id2", "Bcl6","Smarca4",
"Mll1")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$Q3minusOther, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
#####---------- Input v.s. output
out.name <- "InputMinusAvg.bar.pdf"
# Rank order
z.p.tb <- z.p.tb %>% arrange(z.p.tb$InputMinusAvg)
z.p.tb <- within(z.p.tb, z.p.tb$gene_name <- factor(z.p.tb$gene_name, levels=z.p.tb$gene_name))
# Set color for top and bottom quarter
col_panel <- c("steelblue1", "lightgrey", "indianred1")
qt <- as.integer(floor(nrow(z.p.tb)/8))
col.vec <- rep(col_panel[1], qt)
col.vec <- c(col.vec, rep(col_panel[2], nrow(z.p.tb)-2*qt))
col.vec <- c(col.vec, rep(col_panel[3], qt))
z.p.tb$color_use <- col.vec
# Select annotations
anno.vec <- c("Ing3", "Bop1", "Bcl6", "Rpa3", "Mll1")
z.p.tb <- z.p.tb %>%
mutate(pointsize = in_vec(anno.vec, gene_name)) %>%
mutate(annoname = in_vec_name(anno.vec, gene_name))
bar.plot <- ggplot(z.p.tb, aes(z.p.tb$gene_name, z.p.tb$InputMinusAvg, fill=col.vec)) +
geom_col() +
geom_point(size=z.p.tb$pointsize, stroke = 0) +
scale_fill_manual(values=col_panel) +
geom_text_repel(aes(label=annoname), force=5, min.segment.length=0) +
coord_flip() +
scale_y_continuous(position = "right", limits=c(-5.2, 5.2)) +
geom_hline(yintercept=0, size=0.25) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
axis.line.x = element_line(colour="black", size=0.5), axis.title.x = element_blank(),
axis.ticks.y = element_blank(), axis.text.y=element_blank(), axis.title.y = element_blank(),
legend.position = "none")
bar.plot
ggsave(out.name, width=6, height=20, units="cm")
